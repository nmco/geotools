<?xml version="1.0" encoding="UTF-8"?>
<as:AppSchemaDataAccess xmlns:as="http://www.geotools.org/app-schema"
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:schemaLocation="http://www.geotools.org/app-schema AppSchemaDataAccess.xsd">
  <namespaces>
    <Namespace>
      <prefix>npra</prefix>
      <uri>http://www.vegvesen.no/datex/1.0</uri>
    </Namespace>
    <Namespace>
      <prefix>datex</prefix>
      <uri>http://datex2.eu/schema/2/2_0</uri>
    </Namespace>
    <Namespace>
      <prefix>D2LogicalModel</prefix>
      <uri>http://datex2.eu/schema/2/2_0</uri>
    </Namespace>
    <Namespace>
      <prefix>gml</prefix>
      <uri>http://www.opengis.net/gml</uri>
    </Namespace>
  </namespaces>

  <sourceDataStores>
    <DataStore>
      <id>datasource</id>
      <parameters>
        <Parameter>
          <name>data_store</name>
          <value>mongodb://localhost/tests</value>
        </Parameter>
        <Parameter>
          <name>namespace</name>
          <value>http://www.vegvesen.no/datex/1.0</value>
        </Parameter>
        <Parameter>
          <name>schema_store</name>
          <value>file:///tmp/tests</value>
        </Parameter>
        <Parameter>
          <name>data_store_type</name>
          <value>complex</value>
        </Parameter>
      </parameters>
    </DataStore>
  </sourceDataStores>

  <targetTypes>
    <FeatureType>
      <schemaUri>http://localhost/data/schemas/datex.xsd</schemaUri>
    </FeatureType>
    <FeatureType>
      <schemaUri>http://www.datex2.eu/schema/2/2_3/DATEXIISchema_2_2_3.xsd</schemaUri>
    </FeatureType>
  </targetTypes>

  <typeMappings>

    <FeatureTypeMapping>
      <sourceDataStore>datasource</sourceDataStore>
      <sourceType>incidents</sourceType>
      <targetElement>npra:DatexSituationFeature</targetElement>
      <attributeMappings>
        <!-- id -->
        <AttributeMapping>
          <targetAttribute>
            npra:DatexSituationFeature
          </targetAttribute>
          <idExpression>
            <OCQL>jsonSelect('data.datex.datex.id')</OCQL>
          </idExpression>
        </AttributeMapping>
        <!-- custom id -->
        <AttributeMapping>
          <targetAttribute>npra:customID</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.customID')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- header information -->
        <AttributeMapping>
          <targetAttribute>npra:situation/datex:headerInformation/datex:areaOfInterest</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.headerInformation.areaOfInterest')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:situation/datex:headerInformation/datex:confidentiality</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.headerInformation.confidentiality')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:situation/datex:headerInformation/datex:informationStatus</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.headerInformation.informationStatus')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:situation/datex:headerInformation/datex:urgency</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.headerInformation.urgency')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:situation/datex:headerInformation/datex:headerInformationExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.headerInformation.headerInformationExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- geometry -->
        <AttributeMapping>
          <targetAttribute>npra:geometry</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('geometry')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- overall severity -->
        <AttributeMapping>
          <targetAttribute>npra:overallSeverity</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.overallSeverity')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- link situations records -->
        <AttributeMapping>
          <targetAttribute>npra:situation/datex:situationRecord</targetAttribute>
          <sourceExpression>
            <OCQL>collectionLink('data.datex.datex.situationRecord')</OCQL>
            <linkElement>npra:DatexSituationRecord</linkElement>
            <linkField>FEATURE_LINK[1]</linkField>
          </sourceExpression>
          <isMultiple>true</isMultiple>
        </AttributeMapping>
      </attributeMappings>
    </FeatureTypeMapping>

    <FeatureTypeMapping>
      <sourceDataStore>datasource</sourceDataStore>
      <sourceType>incidents</sourceType>
      <targetElement>npra:DatexSituationRecord</targetElement>
      <attributeMappings>
        <!-- collection element random id -->
        <AttributeMapping>
          <targetAttribute>
            npra:DatexSituationRecord
          </targetAttribute>
          <idExpression>
            <OCQL>collectionId('data.datex.datex.situationRecord')</OCQL>
          </idExpression>
        </AttributeMapping>

        <AttributeMapping>
          <targetAttribute>datex:severity</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.severity')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:situationRecordVersionTime</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.situationRecordVersionTime')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:situationRecordCreationReference</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.situationRecordCreationReference')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:situationRecordCreationTime</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.situationRecordCreationTime')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:situationRecordObservationTime</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.situationRecordObservationTime')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:situationRecordVersionTime</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.situationRecordVersionTime')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:situationRecordFirstSupplierVersionTime</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.situationRecordFirstSupplierVersionTime')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:confidentialityOverride</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.confidentialityOverride')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:probabilityOfOccurrence</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.probabilityOfOccurrence')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:severity</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.severity')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:source</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.source')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:validity</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.validity')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:impact</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.impact')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:cause</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.cause')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!--AttributeMapping>
          <targetAttribute>datex:nonGeneralPublicComment</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.nonGeneralPublicComment')</OCQL>
          </sourceExpression>
        </AttributeMapping-->
        <AttributeMapping>
          <targetAttribute>datex:urlLink</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.urlLink')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- group of locations - alert c linear - alert c direction -->
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCDirection/datex:alertCDirectionCoded</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCDirection.alertCDirectionCoded')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCDirection/datex:alertCDirectionExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCDirection.alertCDirectionExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCDirection/datex:alertCDirectionNamed</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCDirection.alertCDirectionNamed')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCDirection/datex:alertCDirectionSense</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCDirection.alertCDirectionSense')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- group of locations - alert c linear -->
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/datex:alertCLinearExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCDirection.alertCLinearExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/datex:alertCLocationCountryCode</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCDirection.alertCLocationCountryCode')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/datex:alertCLocationTableNumber</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCDirection.alertCLocationTableNumber')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/datex:alertCLocationTableVersion</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCDirection.alertCLocationTableVersion')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4LinearExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCDirection.alertCMethod4LinearExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- group of locations - alert c linear - alertCMethod4PrimaryPointLocation -->
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4PrimaryPointLocation/datex:alertCLocation/datex:alertCLocationExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4PrimaryPointLocation.alertCLocation.alertCLocationExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4PrimaryPointLocation/datex:alertCLocation/datex:specificLocation</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4PrimaryPointLocation.alertCLocation.specificLocation')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- add link to alertCLocationName multi language -->
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4PrimaryPointLocation/datex:alertCMethod4PrimaryPointLocationExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4PrimaryPointLocation.alertCMethod4PrimaryPointLocationExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4PrimaryPointLocation/datex:offsetDistance/datex:offsetDistance</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4PrimaryPointLocation.offsetDistance.offsetDistance')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4PrimaryPointLocation/datex:offsetDistance/datex:offsetDistanceExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4PrimaryPointLocation.offsetDistance.offsetDistanceExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- group of locations - alert c linear - alertCMethod4SecondaryPointLocation -->
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4SecondaryPointLocation/datex:alertCLocation/datex:alertCLocationExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4SecondaryPointLocation.alertCLocation.alertCLocationExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4SecondaryPointLocation/datex:alertCLocation/datex:specificLocation</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4SecondaryPointLocation.alertCLocation.specificLocation')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- add link to alertCLocationName multi language -->
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4SecondaryPointLocation/datex:alertCMethod4SecondaryPointLocationExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4SecondaryPointLocation.alertCMethod4SecondaryPointLocationExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4SecondaryPointLocation/datex:offsetDistance/datex:offsetDistance</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4SecondaryPointLocation.offsetDistance.offsetDistance')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:alertCLinear/npra:alertCMethod4SecondaryPointLocation/datex:offsetDistance/datex:offsetDistanceExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCLinear.alertCMethod4SecondaryPointLocation.offsetDistance.offsetDistanceExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- group of locations - simple -->
        <AttributeMapping>
          <targetAttribute>npra:groupOfLocations/npra:destination</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.groupOfLocations.alertCDirection.alertCLinearExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- group of locations -->
        <AttributeMapping>
          <targetAttribute>datex:management</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.management')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>datex:situationRecordExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.situationRecordExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>FEATURE_LINK[1]</targetAttribute>
          <sourceExpression>
            <OCQL>collectionLink('data.datex.datex.situationRecord')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- link to general public comments -->
        <AttributeMapping>
          <targetAttribute>datex:generalPublicComment</targetAttribute>
          <sourceExpression>
            <OCQL>collectionLink('data.datex.datex.situationRecord.generalPublicComment')</OCQL>
            <linkElement>npra:DatexGeneralPublicComment</linkElement>
            <linkField>FEATURE_LINK[2]</linkField>
          </sourceExpression>
          <isMultiple>true</isMultiple>
        </AttributeMapping>
      </attributeMappings>
    </FeatureTypeMapping>

    <FeatureTypeMapping>
      <sourceDataStore>datasource</sourceDataStore>
      <sourceType>incidents</sourceType>
      <targetElement>npra:DatexGeneralPublicComment</targetElement>
      <attributeMappings>
        <!-- collection element random id -->
        <AttributeMapping>
          <targetAttribute>
            npra:DatexGeneralPublicComment
          </targetAttribute>
          <idExpression>
            <OCQL>collectionId('data.datex.datex.situationRecord.generalPublicComment')</OCQL>
          </idExpression>
        </AttributeMapping>
        <!-- comment date time -->
        <AttributeMapping>
          <targetAttribute>datex:commentDateTime</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.generalPublicComment.commentDateTime')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- comment type -->
        <AttributeMapping>
          <targetAttribute>datex:commentType</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.generalPublicComment.commentType')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- comment extension -->
        <AttributeMapping>
          <targetAttribute>datex:commentExtension</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.generalPublicComment.commentExtension')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <!-- link to multi language comments -->
        <AttributeMapping>
          <targetAttribute>datex:comment</targetAttribute>
          <sourceExpression>
            <OCQL>collectionLink('data.datex.datex.situationRecord.generalPublicComment.comment.values.value')</OCQL>
            <linkElement>npra:DatexGeneralPublicCommentMultilingualValue</linkElement>
            <linkField>FEATURE_LINK[3]</linkField>
          </sourceExpression>
          <isMultiple>true</isMultiple>
        </AttributeMapping>
        <!-- link to parent situation -->
        <AttributeMapping>
          <targetAttribute>FEATURE_LINK[2]</targetAttribute>
          <sourceExpression>
            <OCQL>collectionLink('data.datex.datex.situationRecord.generalPublicComment')</OCQL>
          </sourceExpression>
        </AttributeMapping>
      </attributeMappings>
    </FeatureTypeMapping>

    <FeatureTypeMapping>
      <sourceDataStore>datasource</sourceDataStore>
      <sourceType>incidents</sourceType>
      <targetElement>npra:DatexGeneralPublicCommentMultilingualValue</targetElement>
      <attributeMappings>
        <AttributeMapping>
          <targetAttribute>
            npra:DatexGeneralPublicCommentMultilingualValue
          </targetAttribute>
          <idExpression>
            <OCQL>collectionId('data.datex.datex.situationRecord.generalPublicComment.comment.values.value')</OCQL>
          </idExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:lang</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.generalPublicComment.comment.values.value.lang')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>npra:value</targetAttribute>
          <sourceExpression>
            <OCQL>jsonSelect('data.datex.datex.situationRecord.generalPublicComment.comment.values.value.value')</OCQL>
          </sourceExpression>
        </AttributeMapping>
        <AttributeMapping>
          <targetAttribute>FEATURE_LINK[3]</targetAttribute>
          <sourceExpression>
            <OCQL>collectionLink('data.datex.datex.situationRecord.generalPublicComment.comment.values.value')</OCQL>
          </sourceExpression>
        </AttributeMapping>
      </attributeMappings>
    </FeatureTypeMapping>

  </typeMappings>

</as:AppSchemaDataAccess>
